# 初始消息功能使用说明

## 功能实现完成 ✅

已完成初始消息的自动发送逻辑，包括以下步骤：
1. 页面挂载时检查 `initialMessage`
2. 验证消息格式
3. 自动发送初始消息
4. 显示加载动画
5. 流式输出AI回复
6. 状态重置

## 如何使用

### 1. 设置初始消息

在其他页面或组件中设置初始消息：

```javascript
import { useMessageStore } from '@/store/useMessageStore'

const SomePage = () => {
    const { setInitialMessages } = useMessageStore()
    
    const handleNavigateToAI = () => {
        // 设置初始消息
        setInitialMessages([
            {
                content: '行程取消政策',
                role: 'user'
            }
        ])
        
        // 然后导航到AI服务页面
        navigate('/smart-service')
    }
    
    return (
        <button onClick={handleNavigateToAI}>
            询问行程取消政策
        </button>
    )
}
```

### 2. 支持的消息格式

```javascript
// 单条消息
setInitialMessages([
    {
        content: '北京旅游攻略',
        role: 'user'
    }
])

// 目前只处理第一条消息，后续可扩展处理多条
setInitialMessages([
    {
        content: '重庆3日游推荐',
        role: 'user'
    },
    {
        content: '预算3000元',
        role: 'user'
    }
])
```

### 3. 测试示例

在浏览器控制台中测试：

```javascript
// 打开浏览器开发者工具，在控制台中执行：

// 方法1：直接修改store（用于测试）
window.location.hash = '#/smart-service'
// 然后刷新页面，修改store的默认值

// 方法2：模拟外部设置
// 在任何地方调用 setInitialMessages 然后导航到页面
```

## 实现细节

### 核心逻辑位置
- 文件：`src/pages/SmartService/index.jsx`
- 函数：`handleInitialMessage()`
- 触发：`useEffect(() => {}, [])` 在组件挂载时

### 状态管理
- `isSending`: 控制加载动画显示
- `isStreaming`: 控制流式输出状态
- `streamingContent`: 存储流式输出的临时内容

### 错误处理
- 网络错误时显示友好提示
- 消息格式验证
- 状态重置保证组件稳定性

## 预期效果

1. **页面加载** → 检查是否有初始消息
2. **有初始消息** → 自动添加到聊天列表
3. **显示加载动画** → 页面中间两个弹跳小球
4. **调用AI接口** → 流式获取回复
5. **实时显示回复** → Markdown格式渲染
6. **完成后** → 隐藏加载动画，正常聊天状态

## 注意事项

- 初始消息只在页面首次加载时处理一次
- 支持的角色类型：`'user'`（用户消息）
- 消息内容会进行Markdown渲染
- 加载动画至少显示500ms以提升用户体验